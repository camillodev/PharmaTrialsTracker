 npx jest server/__tests__/dataIngestion.test.ts --verbose
  console.error
    Error processing lab result for patient P1001: TypeError: Cannot read properties of undefined (reading 'findFirst')
        at FileProcessor.<anonymous> (/home/runner/workspace/server/services/fileProcessor.ts:250:49)
        at Generator.next (<anonymous>)
        at /home/runner/workspace/server/services/fileProcessor.ts:8:71
        at new Promise (<anonymous>)
        at Object.<anonymous>.__awaiter (/home/runner/workspace/server/services/fileProcessor.ts:4:12)
        at FileProcessor.processXML (/home/runner/workspace/server/services/fileProcessor.ts:198:16)
        at FileProcessor.<anonymous> (/home/runner/workspace/server/services/fileProcessor.ts:87:21)
        at Generator.next (<anonymous>)
        at fulfilled (/home/runner/workspace/server/services/fileProcessor.ts:5:58)

      293 |         }
      294 |       } catch (error) {
    > 295 |         console.error(
          |                 ^
      296 |           `Error processing lab result for patient ${result.patientId}:`,
      297 |           error
      298 |         );

      at FileProcessor.<anonymous> (server/services/fileProcessor.ts:295:17)
      at server/services/fileProcessor.ts:8:71
      at Object.<anonymous>.__awaiter (server/services/fileProcessor.ts:4:12)
      at FileProcessor.processXML (server/services/fileProcessor.ts:198:16)
      at FileProcessor.<anonymous> (server/services/fileProcessor.ts:87:21)
      at fulfilled (server/services/fileProcessor.ts:5:58)

  console.error
    Error processing symptom record for patient P1001: TypeError: Cannot read properties of undefined (reading 'findFirst')
        at FileProcessor.<anonymous> (/home/runner/workspace/server/services/fileProcessor.ts:198:49)
        at Generator.next (<anonymous>)
        at /home/runner/workspace/server/services/fileProcessor.ts:8:71
        at new Promise (<anonymous>)
        at Object.<anonymous>.__awaiter (/home/runner/workspace/server/services/fileProcessor.ts:4:12)
        at FileProcessor.processJSON (/home/runner/workspace/server/services/fileProcessor.ts:165:16)
        at FileProcessor.<anonymous> (/home/runner/workspace/server/services/fileProcessor.ts:85:21)
        at Generator.next (<anonymous>)
        at fulfilled (/home/runner/workspace/server/services/fileProcessor.ts:5:58)

      229 |         }
      230 |       } catch (error) {
    > 231 |         console.error(
          |                 ^
      232 |           `Error processing symptom record for patient ${record.patientId}:`,
      233 |           error
      234 |         );

      at FileProcessor.<anonymous> (server/services/fileProcessor.ts:231:17)
      at server/services/fileProcessor.ts:8:71
      at Object.<anonymous>.__awaiter (server/services/fileProcessor.ts:4:12)
      at FileProcessor.processJSON (server/services/fileProcessor.ts:165:16)
      at FileProcessor.<anonymous> (server/services/fileProcessor.ts:85:21)
      at fulfilled (server/services/fileProcessor.ts:5:58)

  console.error
    Error processing lab result for patient P1001: TypeError: Cannot read properties of undefined (reading 'findFirst')
        at FileProcessor.<anonymous> (/home/runner/workspace/server/services/fileProcessor.ts:250:49)
        at Generator.next (<anonymous>)
        at /home/runner/workspace/server/services/fileProcessor.ts:8:71
        at new Promise (<anonymous>)
        at Object.<anonymous>.__awaiter (/home/runner/workspace/server/services/fileProcessor.ts:4:12)
        at FileProcessor.processXML (/home/runner/workspace/server/services/fileProcessor.ts:198:16)
        at FileProcessor.<anonymous> (/home/runner/workspace/server/services/fileProcessor.ts:87:21)
        at Generator.next (<anonymous>)
        at fulfilled (/home/runner/workspace/server/services/fileProcessor.ts:5:58)

      293 |         }
      294 |       } catch (error) {
    > 295 |         console.error(
          |                 ^
      296 |           `Error processing lab result for patient ${result.patientId}:`,
      297 |           error
      298 |         );

      at FileProcessor.<anonymous> (server/services/fileProcessor.ts:295:17)
      at server/services/fileProcessor.ts:8:71
      at Object.<anonymous>.__awaiter (server/services/fileProcessor.ts:4:12)
      at FileProcessor.processXML (server/services/fileProcessor.ts:198:16)
      at FileProcessor.<anonymous> (server/services/fileProcessor.ts:87:21)
      at fulfilled (server/services/fileProcessor.ts:5:58)

 FAIL  server/__tests__/dataIngestion.test.ts (6.082 s)
  Data Ingestion
    File Type Detection
      ✓ should detect CSV files correctly (2 ms)
      ✓ should detect JSON files correctly (1 ms)
      ✓ should detect XML files correctly (2 ms)
      ✓ should return null for invalid content
    Duplicate Detection
      ✓ should detect duplicate files (40 ms)
    Data Validation
      ✓ should validate lab result data (1 ms)
      ✕ should validate symptom severity range (5 ms)
    Analysis Processing
      ✕ should detect high LDL values (10 ms)

  ● Data Ingestion › Data Validation › should validate symptom severity range

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"count": 1, "type": "symptoms"}

      89 |       }]);
      90 |
    > 91 |       await expect(fileProcessor.processFile(invalidJson)).rejects.toThrow();
         |             ^
      92 |     });
      93 |   });
      94 |

      at expect (node_modules/expect/build/index.js:113:15)
      at server/__tests__/dataIngestion.test.ts:91:13
      at server/__tests__/dataIngestion.test.ts:8:71
      at Object.<anonymous>.__awaiter (server/__tests__/dataIngestion.test.ts:4:12)
      at Object.<anonymous> (server/__tests__/dataIngestion.test.ts:82:61)

  ● Data Ingestion › Analysis Processing › should detect high LDL values

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"data": ObjectContaining {"message": StringContaining "210 mg/dL", "type": "lab"}, "type": "outlier"}

    Number of calls: 0

      112 |       
      113 |       await fileProcessor.processFile(xmlContent);
    > 114 |       expect(mockWss.broadcast).toHaveBeenCalledWith(
          |                                 ^
      115 |         expect.objectContaining({
      116 |           type: 'outlier',
      117 |           data: expect.objectContaining({

      at server/__tests__/dataIngestion.test.ts:114:33
      at fulfilled (server/__tests__/dataIngestion.test.ts:5:58)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 6 passed, 8 total
Snapshots:   0 total
Time:        6.132 s, estimated 13 s
Ran all test suites matching /server\/__tests__\/dataIngestion.test.ts/i.
~/workspace$ 